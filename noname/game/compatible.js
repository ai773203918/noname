const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["noname/library/update.js","noname.js","noname/gnc/index.js","noname/gnc/is.js","noname/util/index.js","noname/ai/index.js","noname/ai/basic.js","noname/library/cache/cacheContext.js","_virtual/index4.js","_virtual/_commonjsHelpers.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/index.js","_virtual/index6.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/core.js","_virtual/_commonjs-dynamic-modules.js","_virtual/core.js","_virtual/___vite-browser-external.js","_virtual/__vite-browser-external.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/x64-core.js","_virtual/x64-core.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/lib-typedarrays.js","_virtual/lib-typedarrays.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/enc-utf16.js","_virtual/enc-utf16.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/enc-base64.js","_virtual/enc-base64.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/enc-base64url.js","_virtual/enc-base64url.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/md5.js","_virtual/md5.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/sha1.js","_virtual/sha1.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/sha256.js","_virtual/sha256.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/sha224.js","_virtual/sha224.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/sha512.js","_virtual/sha512.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/sha384.js","_virtual/sha384.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/sha3.js","_virtual/sha3.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/ripemd160.js","_virtual/ripemd160.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/hmac.js","_virtual/hmac.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/pbkdf2.js","_virtual/pbkdf2.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/evpkdf.js","_virtual/evpkdf.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/cipher-core.js","_virtual/cipher-core.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/mode-cfb.js","_virtual/mode-cfb.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/mode-ctr.js","_virtual/mode-ctr.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/mode-ctr-gladman.js","_virtual/mode-ctr-gladman.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/mode-ofb.js","_virtual/mode-ofb.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/mode-ecb.js","_virtual/mode-ecb.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/pad-ansix923.js","_virtual/pad-ansix923.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/pad-iso10126.js","_virtual/pad-iso10126.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/pad-iso97971.js","_virtual/pad-iso97971.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/pad-zeropadding.js","_virtual/pad-zeropadding.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/pad-nopadding.js","_virtual/pad-nopadding.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/format-hex.js","_virtual/format-hex.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/aes.js","_virtual/aes.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/tripledes.js","_virtual/tripledes.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/rc4.js","_virtual/rc4.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/rabbit.js","_virtual/rabbit.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/rabbit-legacy.js","_virtual/rabbit-legacy.js","node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/blowfish.js","_virtual/blowfish.js","noname/status/index.js","noname/game/PauseManager.js","noname/library/index.js","noname/library/init/index.js","noname/library/init/promises.js","noname/library/element/gameEvent.js","noname/library/element/index.js","noname/library/element/button.js","noname/ui/index.js","noname/ui/click/index.js","noname/get/index.js","noname/get/is.js","noname/game/index.js","_virtual/preload-helper.js","noname/game/dynamic-style/index.js","noname/game/promises.js","noname/game/check.js","noname/util/security.js","noname/util/config.js","noname/util/utils.js","noname/get/promises.js","node_modules/.pnpm/pinyin-pro@3.27.0/node_modules/pinyin-pro/dist/index.js","noname/get/pinyins/noname-dict.js","noname/get/audio.js","noname/util/error.js","noname/util/promise-error-handler/index.js","noname/util/promise-error-handler/chrome.js","noname/util/promise-error-handler/firefox.js","noname/util/promise-error-handler/unknown.js","_virtual/error-stack-parser.js","node_modules/.pnpm/error-stack-parser@2.1.4/node_modules/error-stack-parser/error-stack-parser.js","_virtual/error-stack-parser2.js","node_modules/.pnpm/stackframe@1.3.4/node_modules/stackframe/stackframe.js","_virtual/stackframe.js","_virtual/stacktrace-gps.js","node_modules/.pnpm/stacktrace-gps@3.1.2/node_modules/stacktrace-gps/stacktrace-gps.js","_virtual/stacktrace-gps2.js","node_modules/.pnpm/source-map@0.5.6/node_modules/source-map/lib/source-map-consumer.js","_virtual/source-map-consumer.js","node_modules/.pnpm/source-map@0.5.6/node_modules/source-map/lib/util.js","_virtual/util.js","node_modules/.pnpm/source-map@0.5.6/node_modules/source-map/lib/binary-search.js","_virtual/binary-search.js","node_modules/.pnpm/source-map@0.5.6/node_modules/source-map/lib/array-set.js","_virtual/array-set.js","node_modules/.pnpm/source-map@0.5.6/node_modules/source-map/lib/base64-vlq.js","_virtual/base64-vlq.js","node_modules/.pnpm/source-map@0.5.6/node_modules/source-map/lib/base64.js","_virtual/base642.js","node_modules/.pnpm/source-map@0.5.6/node_modules/source-map/lib/quick-sort.js","_virtual/quick-sort.js","_virtual/index5.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/index.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/base64.js","_virtual/base64.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/object.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/support.js","_virtual/support.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/utils.js","_virtual/utils.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/compressions.js","_virtual/compressions.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/flate.js","_virtual/flate.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/index.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/utils/common.js","_virtual/common.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/deflate.js","_virtual/deflate.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/deflate.js","_virtual/deflate2.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/trees.js","_virtual/trees.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/adler32.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/crc32.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/messages.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/utils/strings.js","_virtual/strings.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/zstream.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/inflate.js","_virtual/inflate.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/inflate.js","_virtual/inflate2.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/inffast.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/inftrees.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/constants.js","node_modules/.pnpm/pako@1.0.11/node_modules/pako/lib/zlib/gzheader.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/nodeBuffer.js","_virtual/nodeBuffer.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/crc32.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/signature.js","_virtual/signature.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/defaults.js","_virtual/defaults.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/compressedObject.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/utf8.js","_virtual/utf8.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/stringWriter.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/uint8ArrayWriter.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/load.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/zipEntries.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/stringReader.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/dataReader.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/nodeBufferReader.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/uint8ArrayReader.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/arrayReader.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/zipEntry.js","node_modules/.pnpm/jszip@2.7.0/node_modules/jszip/lib/deprecatedPublicUtils.js","_virtual/deprecatedPublicUtils.js","noname/get/compatible.js","noname/library/poptip.js","noname/ui/create/index.js","noname/ui/create/menu/index.js","noname/ui/create/menu/pages/cardPackMenu.js","noname/ui/create/menu/pages/characterPackMenu.js","noname/ui/create/menu/pages/exetensionMenu.js","noname/library/element/character.js","noname/ui/create/menu/pages/optionsMenu.js","noname/ui/create/menu/pages/otherMenu.js","node_modules/.pnpm/vue@3.5.21_typescript@5.9.2/node_modules/vue/dist/vue.runtime.esm-bundler.js","node_modules/.pnpm/@vue_runtime-dom@3.5.21/node_modules/@vue/runtime-dom/dist/runtime-dom.esm-bundler.js","node_modules/.pnpm/@vue_runtime-core@3.5.21/node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.js","node_modules/.pnpm/@vue_reactivity@3.5.21/node_modules/@vue/reactivity/dist/reactivity.esm-bundler.js","node_modules/.pnpm/@vue_shared@3.5.21/node_modules/@vue/shared/dist/shared.esm-bundler.js","node_modules/.pnpm/dedent@1.7.0/node_modules/dedent/dist/dedent.js","noname/ui/create/menu/pages/startMenu.js","noname/util/pagination.js","noname/library/element/card.js","noname/library/element/client.js","noname/library/element/content.js","noname/library/element/player.js","noname/library/cache/childNodesWatcher.js","noname/library/element/GameEvent/compilers/ContentCompiler.js","noname/library/element/GameEvent/compilers/StepCompiler.js","noname/library/element/GameEvent/compilers/ContentCompilerBase.js","noname/library/element/GameEvent/compilers/YieldCompiler.js","noname/library/element/GameEvent/compilers/AsyncCompiler.js","noname/library/element/GameEvent/compilers/ArrayCompiler.js","noname/library/element/control.js","noname/library/element/dialog.js","noname/library/element/gameEventPromise.js","noname/library/element/nodeWS.js","noname/library/element/vcard.js","noname/library/element/GameEvent/GameEventManager.js","noname/library/announce/index.js","noname/library/channel/index.js","noname/library/experimental/index.js","noname/library/experimental/symbol.js","noname/library/update-urls.js","noname/library/hooks/index.js","noname/library/hooks/hook.js","noname/library/hooks/buildin.js","noname/library/assembly/index.js","noname/library/assembly/buildin.js","noname/library/concurrent/index.js","noname/init/onload/index.js","noname/init/onload/default-splash.js","noname/init/onload/OnloadSplash.vue.js","noname/init/onload/OnloadSplash.vue2.js","noname/init/onload/wide-splash.js","noname/library/zhanfa.js","noname/library/skill.js","noname/init/index.js","noname/init/import.js","noname/init/onload.js","noname/util/mutex.js","noname/init/loading.js","noname/util/initRealms.js"])))=>i.map(i=>d[i]);
import { __vitePreload } from "../../_virtual/preload-helper.js";
import { userAgentLowerCase, compatibleEnvironment, androidNewStandardApp, device } from "../util/index.js";
import { get } from "../get/compatible.js";
class GameCompatible {
  /**
   * `game/game.js`中退出客户端用到的代码
   *
   * @author Spmario233
   */
  exit() {
    const ios = userAgentLowerCase.includes("iphone") || userAgentLowerCase.includes("ipad") || userAgentLowerCase.includes("macintosh");
    if (typeof window.process == "object" && typeof window.require == "function") {
      const versions = window.process.versions;
      const electronVersion = parseFloat(versions.electron);
      let remote;
      if (electronVersion >= 14) {
        remote = require("@electron/remote");
      } else {
        remote = require("electron").remote;
      }
      const thisWindow = remote.getCurrentWindow();
      thisWindow.destroy();
      window.process.exit();
    } else if (!ios) {
      window.close();
    }
  }
  /**
   * @async
   * @param {UpdateReason} type
   * @param {string} [text]
   * @returns {Promise<unknown>}
   */
  tryUpdateClient(type, text = "") {
    if (!compatibleEnvironment && type != UpdateReason.DEBUG) {
      return Promise.resolve();
    }
    function update(url, { request, createProgress }) {
      let fileName = void 0;
      let progress = createProgress("正在下载最新客户端");
      return request(url, (receivedBytes, total, filename) => {
        if (typeof filename == "string") {
          progress.setFileName(filename);
          fileName = filename;
        }
        let received = 0, max = 0;
        if (total) {
          max = +(total / (1024 * 1024)).toFixed(1);
        } else {
          max = 1e3;
        }
        received = +(receivedBytes / (1024 * 1024)).toFixed(1);
        if (received > max) {
          max = received;
        }
        progress.setProgressMax(max);
        progress.setProgressValue(received);
      }).then((result) => (progress.remove(), result)).then((blob) => (blob.name = fileName, blob));
    }
    function open(blob) {
      let link = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = link;
      a.download = blob.name;
      a.addEventListener("click", () => {
        setTimeout(() => URL.revokeObjectURL(link), 100);
      });
      a.click();
    }
    function fallback(text2) {
      if (confirm(text2)) {
        window.open("https://github.com/libnoname/noname/releases/tag/chromium85-client");
      }
    }
    switch (type) {
      case UpdateReason.DEBUG: {
        let url = "https://ghproxy.cc/https://github.com/libnoname/noname/releases/download/chromium85-client/Noname-linux-x64.zip";
        return __vitePreload(() => import("../library/update.js"), true ? __vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252]) : void 0).then((module) => update(url, module)).then(open);
      }
      case UpdateReason.FALLBACK: {
        fallback(text);
        return Promise.resolve();
      }
      case UpdateReason.UNDERSUPPORT: {
        let [_coreName, coreVersion] = get.coreInfo();
        let needToWait = Promise.resolve();
        if (androidNewStandardApp) {
          let tips = ["您使用的无名杀客户端已达到最新，但目前的浏览器内核版本过低，未来可能将无法使用！", "目前使用的浏览器UA信息为: ", userAgentLowerCase, "新版本的客户端在机器存在Chrome的情况下会直接使用Chrome的内核", "请前往下载最新版的Chrome，以获取最佳的体验！", "稍后游戏将继续正常运行，但我们不保证不会出现任何报错"].join("\n");
          let packageName = window.NonameAndroidBridge.getPackageName();
          if (!(packageName.includes("shijian") || packageName.includes("yuri"))) {
            tips = ["您使用的无名杀客户端已达到最新，但目前的浏览器内核版本过低，未来可能将无法使用！", "目前使用的浏览器UA信息为: ", userAgentLowerCase, "检测到你现在使用的是第三方客户端，请联系客户端制作者寻求帮助！", "稍后游戏将继续正常运行，但我们不保证不会出现任何报错"].join("\n");
          }
          alert(tips);
        } else if (device == "android") {
          let callback = function(module) {
            if (confirm(tips)) {
              let url = "https://ghproxy.cc/https://github.com/libnoname/noname/releases/download/chromium85-client/Noname-yuri-v1.9.3.apk";
              if (coreVersion == 77) {
                let compatibleTips = ["检测到你现在的版本号为上版本兼容版的版本号，由于当前版本无法确认是否为兼容版，特此在此再次询问", "请问你是否需要下载最新的兼容版？", "（目前由理版可直接使用已安装的Chrome内核，但如果无法安装最新的Chrome，依然需要兼容版）"].join("\n");
                if (confirm(compatibleTips)) {
                  url = "https://ghproxy.cc/https://github.com/libnoname/noname/releases/download/chromium85-client/Noname-yuri-compatible-v1.8.4.apk";
                }
              }
              return update(url, module).then(open);
            }
            return Promise.resolve();
          };
          let tips = ["你使用的无名杀客户端版本号未达到最新无名杀需要的要求，未来可能将无法正常运行无名杀！", "目前使用的浏览器UA信息为: ", userAgentLowerCase, "如果你使用的是第三方客户端，请联系客户端制作者更新或寻求解决方法！", "点击“确认”将开始下载最新版客户端（如果你使用的是第三方客户端，请不要点击“确认”）", "稍后游戏将继续正常运行，但我们不保证不会出现任何报错"].join("\n");
          let fallbacks = ["你使用的无名杀客户端版本号未达到最新无名杀需要的要求，已无法正常运行无名杀！", "目前使用的浏览器UA信息为: ", userAgentLowerCase, "如果你使用的是第三方客户端，请联系客户端制作者更新或寻求解决方法！", "点击“确认”以前往GitHub下载最新版无名杀客户端（可能需要科学上网）"].join("\n");
          needToWait = __vitePreload(() => import("../library/update.js"), true ? __vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252]) : void 0).then(callback, () => fallback(fallbacks));
        } else if (typeof window.require == "function") {
          let tips = ["你使用的无名杀客户端版本号未达到最新无名杀需要的要求，未来可能将无法正常运行无名杀！", "目前使用的浏览器UA信息为: ", userAgentLowerCase, "如果你使用的是第三方客户端，请联系客户端制作者更新或寻求解决方法！", "点击“确认”以前往GitHub下载最新版无名杀客户端（可能需要科学上网）", "稍后游戏将继续正常运行，但我们不保证不会出现任何报错"].join("\n");
          fallback(tips);
        } else {
          let tips = ["你使用的浏览器内核已无法达到无名杀的最低要求，未来可能将无法使用！", "请更新你的Google Chrome/Chromium内核！", "稍后游戏将继续正常运行，但我们不保证不会出现任何报错"].join("\n");
          alert(tips);
        }
        return needToWait;
      }
      default: {
        return Promise.reject();
      }
    }
  }
}
let game = new GameCompatible();
const UpdateReason = {
  DEBUG: 1,
  FALLBACK: 2,
  UNDERSUPPORT: 4
};
export {
  GameCompatible,
  UpdateReason,
  game
};
