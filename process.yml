# ========================================================================
# PM2 进程管理配置文件 (process.yml)
# ========================================================================
# 该文件定义了由 PM2 管理的三个主要应用服务：
# 1. web-server:    静态文件和 HTTP API 服务
# 2. game-lobby:    游戏大厅逻辑服务器
# 3. fs-server:     文件系统服务

apps:
  # --------------------------------------------------------------------
  # 应用 1: Web 服务器
  # --------------------------------------------------------------------
  - name: 'web-server'  # 为该进程指定一个易于识别的名称，用于日志和监控
    script: './http-server.js'  # 指定要执行的脚本文件路径，该路径相对于 `cwd`
    cwd: '/app'  # 设置进程启动时的工作目录。所有相对路径都将基于此目录解析
    env:
      NODE_ENV: 'production'  # 为该进程设置环境变量，明确指定为生产模式

  # --------------------------------------------------------------------
  # 应用 2: 游戏大厅服务器
  # --------------------------------------------------------------------
  - name: 'game-lobby'  # 进程名称
    script: './server.cjs'  # 指定脚本。使用 .cjs 后缀强制以 CommonJS 模式运行
    cwd: '/app'  # 工作目录，与 web-server 保持一致
    env:
      NODE_ENV: 'production'  # 设置为生产模式

  # --------------------------------------------------------------------
  # 应用 3: 文件系统 (fs) 服务器
  # --------------------------------------------------------------------
  - name: 'fs-server'  # 进程名称
    # 指定脚本路径。该脚本是 `packages/fs` 包构建后的入口文件
    script: './packages/fs/dist/entry.cjs'
    cwd: '/app'  # 工作目录
    env:
      NODE_ENV: 'production'  # 设置为生产模式
      # 显式指定 `fs-server` 监听的端口。
      # 这是一种良好实践，可避免端口冲突，并使配置清晰可查。
      PORT: 8089
